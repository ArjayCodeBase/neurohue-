<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>NeuroHue — Dashboard</title>
<style>
  :root{
    --teal:#268ea6;
    --dark:#093c44;
    --card-bg:#ffffff;
    --muted:#f3f6f7;
    --sidebar-width:280px;
    --breakpoint:900px;
    --topbar-height:64px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: "Arial",sans-serif;
    background: #ffffff;
    color:#08343a;
    min-height:100vh;
    -webkit-font-smoothing:antialiased;
  }

  /* Topbar: FULL WIDTH fixed at top */
  .topbar{
    height:var(--topbar-height);
    background:var(--teal);
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:0 18px;
    color:#fff;
    box-shadow: 0 1px 0 rgba(0,0,0,0.06);
    position:fixed;
    top:0;
    left:0;
    right:0;
    z-index:120; /* above sidebar/backdrop and content */
  }
  .brand {
    display:flex;
    align-items:center;
    gap:10px;
    font-weight:700;
  }
  .brand img{ height:34px; width:34px; border-radius:6px; object-fit:cover }
  .brand .title { font-size:18px; }

  .topbar-right {
    display:flex;
    align-items:center;
    gap:12px;
    position:relative;
  }

  .plan-badge{
    background:#fff3cf;
    color:#7a5a10;
    padding:6px 10px;
    border-radius:10px;
    font-size:13px;
    display:flex;
    align-items:center;
    gap:6px;
  }

  .profile {
    background: #0b2b2b;
    color: #fff;
    padding:6px 10px;
    border-radius:22px;
    display:flex;
    align-items:center;
    gap:10px;
    cursor:pointer;
    position:relative;
  }
  .profile .avatar {
    width:34px;height:34px;border-radius:50%;background:#fff;color:var(--dark);display:flex;align-items:center;justify-content:center;font-weight:700;
  }
  .profile .name { font-weight:700; font-size:14px; color: #fff; }

  /* language buttons */
  .lang-switch {
    display:flex;
    gap:6px;
    align-items:center;
  }
  .lang-btn{
    background:transparent;
    border:1px solid rgba(255,255,255,0.18);
    color:#fff;
    padding:6px 8px;
    border-radius:6px;
    cursor:pointer;
    font-weight:700;
    font-size:13px;
  }
  .lang-btn.active{
    background:#fff;
    color:var(--teal);
    border-color:transparent;
  }

  /* page container below topbar */
  .page {
    display:flex;
    min-height: calc(100vh - var(--topbar-height));
    margin-top: var(--topbar-height); /* push below fixed topbar */
  }

  /* sidebar - desktop persistent, mobile slide-in */
  .sidebar {
    width:var(--sidebar-width);
    background: #f9fbfc;
    border-right:1px solid #ebeff0;
    padding:18px;
    transform: translateX(-360px);
    transition: transform .22s ease, box-shadow .22s ease;
    position:fixed;
    left:0;
    top:var(--topbar-height); /* sit below topbar */
    bottom:0;
    z-index:90;
    overflow:auto;
  }
  .sidebar.open { transform: translateX(0); box-shadow: 2px 0 24px rgba(8,52,54,0.08); }

  /* When on wide screens, show sidebar inline and make it non-overlaying */
  @media (min-width: calc(var(--breakpoint) + 1px)) {
    .sidebar {
      position:relative;
      transform:none;
      box-shadow:none;
      height: auto;
      top:0;
      left:0;
      z-index:10;
      max-height:none;
    }
    .sidebar.open { transform:none; box-shadow:none; }
  }

  .nav-section { margin-top:6px; }
  .nav-item{
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:10px 12px;
    border-radius:8px;
    cursor:pointer;
    color:#08343a;
    margin-bottom:6px;
  }
  .nav-item:hover{ background: #eef6f7; }

  .hamburger{
    width:40px;height:40px;border-radius:6px;display:flex;align-items:center;justify-content:center;cursor:pointer;background:transparent;border:none;color:#fff;font-size:22px;
  }

  /* sidebar backdrop for mobile */
  .sidebar-backdrop {
    position:fixed;
    inset:var(--topbar-height) 0 0 0; /* sit below topbar */
    background: rgba(0,0,0,0.35);
    display:none;
    z-index:85;
    transition: opacity .18s ease;
  }
  .sidebar-backdrop.show { display:block; }

  /* main content */
  .content {
    flex:1;
    padding:32px;
    transition: margin-left .22s ease;
    width:100%;
  }

  /* when desktop and sidebar visible, push content */
  @media (min-width: calc(var(--breakpoint) + 1px)) {
    .content.shifted { margin-left: var(--sidebar-width); }
  }

  .page-title {
    text-align:center;
    color:var(--dark);
    font-weight:800;
    font-size:28px;
    margin-top:6px;
    margin-bottom:18px;
  }

  /* cards area placeholder */
  .grid {
    display:grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap:20px;
    max-width:1100px;
    margin:22px auto 0;
  }
  .card {
    background:var(--card-bg);
    border-radius:10px;
    padding:18px;
    box-shadow:0 6px 18px rgba(8,52,54,0.03);
    min-height:120px;
  }
  .card h4{ margin:0 0 8px 0; color:var(--dark); }
  .card p{ margin:0;color:#556971; font-size:14px }

  /* profile dropdown */
  .profile-menu{
    position:absolute;
    right:18px;
    top:calc(var(--topbar-height));
    background:#fff;
    border:1px solid #e6eef0;
    border-radius:8px;
    min-width:180px;
    box-shadow:0 6px 20px rgba(8,52,54,0.08);
    display:none;
    z-index:130;
  }
  .profile-menu.open{ display:block; }
  .profile-menu button{
    width:100%;
    border:none;
    background:transparent;
    padding:10px 12px;
    text-align:left;
    cursor:pointer;
  }
  .profile-menu button:hover{ background:#f2f8f9; }

  /* activity submenu inside sidebar */
  .sublist { padding-left:6px; margin-top:6px; display:none; }
  .sublist.open { display:block; }
  .sublist .subitem {
    display:block;
    padding:8px 10px;
    border-radius:6px;
    cursor:pointer;
    font-size:14px;
    color:#2b4d50;
    text-decoration:none;
  }
  .sublist .subitem:hover { background:#eef6f7; }
  .sublist .subitem:focus { outline:2px solid #bfeef7; }

  /* responsive tweaks */
  @media (max-width:900px){
    .content { padding:18px; }
    .page-title { font-size:20px; text-align:left; }
    .brand .title { display:none; } /* compact logo on mobile */
    .plan-badge { display:none; }   /* hide large badge on small screens */
    .profile .name { display:none; } /* compact profile on mobile */
  }

  /* micro accessibility/visual */
  button:focus { outline:3px solid rgba(14,127,168,0.18); outline-offset:2px; }
  a { color:inherit; text-decoration:none; }
</style>
</head>
<body>
  <div class="topbar" role="banner">
    <div style="display:flex;align-items:center;gap:14px">
      <button id="hamburger" class="hamburger" title="Menu" aria-label="Open menu" aria-controls="sidebar" aria-expanded="false" data-i18n="menu" data-i18n-attr="title">
        ☰
      </button>
      <div class="brand" aria-hidden="true">
        <img src="logo.png" alt="logo" />
        <div class="title" data-i18n="brand.title">NeuroHue</div>
      </div>
    </div>

    <div class="topbar-right" style="position:relative">
      <div class="plan-badge" id="planBadge" aria-hidden="true" data-i18n="plan.badge">Basic Plan</div>

      <div class="lang-switch" role="tablist" aria-label="Language switch">
        <button id="langEn" class="lang-btn" role="tab" aria-selected="true">EN</button>
        <button id="langTl" class="lang-btn" role="tab" aria-selected="false">TL</button>
        <button id="langCb" class="lang-btn" role="tab" aria-selected="false">CEB</button>
      </div>

      <div id="profileBtn" class="profile" title="Account" aria-haspopup="true" aria-expanded="false" data-i18n="profile.account" data-i18n-attr="title">
        <div class="avatar" id="avatar"></div>
        <div class="name" id="topUsername"></div>
      </div>

      <!-- small profile dropdown -->
      <div id="profileMenu" class="profile-menu" aria-hidden="true">
        <button id="viewProfileBtn" data-i18n="profile.view">View Profile</button>
        <button id="goToAssess" data-i18n="profile.assess">Initial Assessment</button>
        <button id="logoutBtn" data-i18n="profile.logout">Log Out</button>
      </div>
    </div>
  </div>

  <div class="page">
    <!-- mobile backdrop -->
    <div id="sidebarBackdrop" class="sidebar-backdrop" aria-hidden="true" tabindex="-1"></div>

    <aside id="sidebar" class="sidebar" aria-hidden="true" aria-label="Main menu">
      <div style="display:flex;align-items:center;justify-content:space-between">
        <strong style="font-size:14px" data-i18n="menu">Menu</strong>
        <small style="color:#6b8e90" data-i18n="user.actions">User Actions</small>
      </div>

      <div class="nav-section">
        <div class="nav-item" id="navRoutine" role="button" tabindex="0" title="Go to Routines" data-i18n="nav.routine">
          <div>Routine</div>
          <div style="font-size:13px;color:#6b8e90">⤴</div>
        </div>

        <div class="nav-item" id="activityToggle" role="button" aria-expanded="false" tabindex="0" data-i18n="nav.activity">
          <div>Activity</div>
          <div id="activityToggleIcon" style="font-size:13px;color:#6b8e90">▸</div>
        </div>

        <div id="activitySub" class="sublist" aria-hidden="true" role="menu">
          <a class="subitem" data-activity="gross" href="gross.html" role="menuitem" tabindex="-1" data-i18n="sub.gross">Gross Motor Skills</a>
          <a class="subitem" data-activity="fine" href="fine.html" role="menuitem" tabindex="-1" data-i18n="sub.fine">Fine Motor Skills</a>
          <a class="subitem" data-activity="speech" href="speech.html" role="menuitem" tabindex="-1" data-i18n="sub.speech">Speech &amp; Learning</a>
          <a class="subitem" data-activity="cognitive" href="cognitive.html" role="menuitem" tabindex="-1" data-i18n="sub.cognitive">Cognitive &amp; Learning</a>
          <a class="subitem" data-activity="behavior" href="behavior.html" role="menuitem" tabindex="-1" data-i18n="sub.behavior">Behavior &amp; Social Skills</a>
        </div>
      </div>

      <hr style="margin:14px 0;border:none;border-top:1px solid #eef4f5" />
      <div style="font-size:13px;color:#5f7a7c" data-i18n="summary.title">Summary</div>
      <div style="height:8px"></div>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <button id="btnProgress" style="padding:8px 12px;border-radius:8px;border:1px solid #e6eef0;background:#fff;color:#2b4d50;cursor:pointer" data-i18n="btn.progress">Progress</button>
        <button id="btnTranslation" style="padding:8px 12px;border-radius:8px;border:1px solid #e6eef0;background:#fff;color:#2b4d50;cursor:pointer" data-i18n="btn.translation">Report</button>
      </div>
    </aside>

    <main class="content" role="main" id="mainContent">
      <div class="page-title" data-i18n="page.title">Dashboard</div>

      <div class="grid" id="dashboardGrid">
        <div class="card">
          <h4 data-i18n="card.routines.title">Today's Routines</h4>
          <p id="todaysRoutines" data-i18n="card.routines.text">You have 0 tasks scheduled for today.</p>
        </div>

        <div class="card">
          <h4 data-i18n="card.activity.title">Recent Activity</h4>
          <p id="recentActivity" data-i18n="card.activity.text">No recorded activity yet.</p>
        </div>

        <div class="card">
          <h4 data-i18n="card.initial.title">Initial Assessment</h4>
          <p id="initialText" data-i18n="card.initial.text">Complete the initial progress assessment to personalize recommendations.</p>
        </div>

        <div class="card">
          <h4 data-i18n="card.subscription.title">Subscription</h4>
          <p id="subInfo" data-i18n="card.subscription.text">Basic Plan — active</p>
        </div>
      </div>
    </main>
  </div>

<script>
  // helper: select by id
  function $(id){ return document.getElementById(id); }

  // translations: keys -> { en, tl, ceb }
  const i18n = {
    "brand.title": { en: "NeuroHue", tl: "NeuroHue", ceb: "NeuroHue" },

    "menu": { en: "Menu", tl: "Menu", ceb: "Menu" },
    "user.actions": { en: "User Actions", tl: "Mga Aksyon", ceb: "Mga Aksyon" },

    "nav.routine": { en: "Routine", tl: "Rutin", ceb: "Rutin" },
    "nav.activity": { en: "Activity", tl: "Aktibidad", ceb: "Aktibidad" },

    "sub.gross": { en: "Gross Motor Skills", tl: "Gross Motor (Malaking Galaw)", ceb: "Gross Motor (Dako nga Galaw)" },
    "sub.fine": { en: "Fine Motor Skills", tl: "Fine Motor (Maliit na Galaw)", ceb: "Fine Motor (Gamay nga Galaw)" },
    "sub.speech": { en: "Speech & Learning", tl: "Pagsasalita at Pagkatuto", ceb: "Pagsulti ug Pagkat-on" },
    "sub.cognitive": { en: "Cognitive & Learning", tl: "Kognitibo at Pagkatuto", ceb: "Kahibalo ug Pagkat-on" },
    "sub.behavior": { en: "Behavior & Social Skills", tl: "Pag-uugali at Sosyal na Kasanayan", ceb: "Pamatasan ug Sosyal nga Kahanas" },

    "summary.title": { en: "Summary", tl: "Buod", ceb: "Buod" },
    "btn.progress": { en: "Progress", tl: "Progreso", ceb: "Progreso" },
    "btn.translation": { en: "Translation", tl: "Salin", ceb: "Hubad" },

    "page.title": { en: "Dashboard", tl: "Dashboard", ceb: "Dashboard" },

    "card.routines.title": { en: "Today's Routines", tl: "Mga Rutin Ngayon", ceb: "Mga Rutin Karong Adlawa" },
    // template placeholder {n}
    "card.routines.text": {
      en: "You have {n} tasks scheduled for today.",
      tl: "Mayroon kang {n} gawain na naka-iskedyul para sa ngayon.",
      ceb: "Aduna kay {n} nga buluhaton karon."
    },

    "card.activity.title": { en: "Recent Activity", tl: "Kamakailang Aktibidad", ceb: "Bag-ong Aktibidad" },
    "card.activity.text": { en: "No recorded activity yet.", tl: "Wala pang naitalang aktibidad.", ceb: "Wala pa'y narekord nga aktibidad." },

    "card.initial.title": { en: "Initial Assessment", tl: "Paunang Pagsusuri", ceb: "Inisyal nga Pagtasa" },
    "card.initial.text": {
      en: "Complete the initial progress assessment to personalize recommendations.",
      tl: "Kumpletuhin ang paunang pagsusuri upang i-personalize ang mga rekomendasyon.",
      ceb: "Tapos-a ang inisyal nga pagtasa aron ma-personalize ang mga rekomendasyon."
    },

    "card.subscription.title": { en: "Subscription", tl: "Subskripsyon", ceb: "Subskripsyon" },
    "card.subscription.text": { en: "Basic Plan — active", tl: "Basic Plan — aktibo", ceb: "Basic Plan — aktibo" },

    "plan.badge": { en: "Basic Plan", tl: "Basic Plan", ceb: "Basic Plan" },

    "profile.account": { en: "Account", tl: "Account", ceb: "Account" },
    "profile.view": { en: "View Profile", tl: "Tingnan ang Profile", ceb: "Tan-awa ang Profile" },
    "profile.assess": { en: "Initial Assessment", tl: "Paunang Pagsusuri", ceb: "Inisyal nga Pagtasa" },
    "profile.logout": { en: "Log Out", tl: "Mag-logout", ceb: "Log Out" }
  };

  // demo data that translators can inject
  const demoData = {
    n: 3,
    recentActivity: "Matched 2 shapes • Submitted checklist"
  };

  // current locale (persisted)
  function getStoredLocale(){ return localStorage.getItem('locale') || 'en'; }
  function setStoredLocale(l){ localStorage.setItem('locale', l); }

  // apply translation for all elements with data-i18n
  function translatePage(locale) {
    if (!locale) locale = getStoredLocale();
    // set active class on language buttons
    ['langEn','langTl','langCb'].forEach(id=>{
      const el = $(id);
      if (!el) return;
      el.classList.toggle('active', id === (locale === 'en' ? 'langEn' : locale === 'tl' ? 'langTl' : 'langCb'));
      el.setAttribute('aria-selected', String(el.classList.contains('active')));
    });

    // all elements with data-i18n
    document.querySelectorAll('[data-i18n]').forEach(el=>{
      const key = el.getAttribute('data-i18n');
      const attr = el.getAttribute('data-i18n-attr'); // optional: set attribute like title instead of text
      const translations = i18n[key];
      if (!translations) return; // skip unknown keys

      let txt = translations[locale] ?? translations['en'] ?? '';

      // replace placeholders if present
      txt = txt.replace(/\{n\}/g, String(demoData.n));
      txt = txt.replace(/\{activity\}/g, demoData.recentActivity);

      if (attr) {
        try { el.setAttribute(attr, txt); } catch(e){ /* noop */ }
      } else {
        // many nodes are <a> or buttons or divs — set textContent to keep it safe
        el.textContent = txt;
      }
    });

    // There are a few dynamic elements not using data-i18n templates (we still set them explicitly)
    // todaysRoutines and recentActivity (they already have data-i18n keys above but we ensure correct dynamic text)
    const rEl = $('todaysRoutines');
    if (rEl) {
      const t = (i18n['card.routines.text'][locale] || i18n['card.routines.text'].en).replace(/\{n\}/g, String(demoData.n));
      rEl.textContent = t;
    }
    const aEl = $('recentActivity');
    if (aEl) {
      // if translation includes placeholder {activity} use it; else set demo string
      const trans = i18n['card.activity.text'][locale] || i18n['card.activity.text'].en;
      // for activity we want demoData.recentActivity in the english card.activity.text is not templated;
      // so we set it directly only when the static message is the default; keep simple:
      if (trans && trans.indexOf('{activity}') !== -1) {
        aEl.textContent = trans.replace('{activity}', demoData.recentActivity);
      } else {
        // If translation is the "No recorded activity yet." string, keep it.
        aEl.textContent = trans;
      }
    }
  }

  // initialize locale & UI
  document.addEventListener('DOMContentLoaded', () => {
    // show user from storage
    const rawUser = localStorage.getItem('user') || sessionStorage.getItem('user') || null;
    let username = 'User';
    if (rawUser) {
      try {
        const parsed = JSON.parse(rawUser);
        const u = parsed.user ?? parsed;
        username = u.username ?? u.name ?? parsed.username ?? 'User';
      } catch(e){}
    } else {
      username = localStorage.getItem('username') || sessionStorage.getItem('username') || 'User';
    }
    $('topUsername').textContent = username;
    $('avatar').textContent = (username && username[0]) ? username[0].toUpperCase() : 'U';

    // set up language buttons
    $('langEn').addEventListener('click', ()=>{ setStoredLocale('en'); translatePage('en'); });
    $('langTl').addEventListener('click', ()=>{ setStoredLocale('tl'); translatePage('tl'); });
    $('langCb').addEventListener('click', ()=>{ setStoredLocale('ceb'); translatePage('ceb'); });

    // sidebar initial state (desktop open, mobile closed)
    setSidebar(window.innerWidth > 900);

    // wire sidebar hamburger
    $('hamburger').addEventListener('click', ()=> {
      setSidebar(!sidebarOpen, { shouldFocusToggle: true });
    });

    // profile dropdown
    profileBtn.addEventListener('click', (e) => {
      profileOpen = !profileOpen;
      profileMenu.classList.toggle('open', profileOpen);
      profileMenu.setAttribute('aria-hidden', String(!profileOpen));
      profileBtn.setAttribute('aria-expanded', String(profileOpen));
    });

    // close profile menu when clicking outside (handled below)
    document.addEventListener('click', (e) => {
      if (!profileBtn.contains(e.target) && !profileMenu.contains(e.target)) {
        profileOpen = false;
        profileMenu.classList.remove('open');
        profileMenu.setAttribute('aria-hidden', 'true');
        profileBtn.setAttribute('aria-expanded', 'false');
      }
    });

    // activity toggle wiring
    if (activityToggle) {
      activityToggle.addEventListener('click', () => {
        activityOpen = !activityOpen;
        activitySub.classList.toggle('open', activityOpen);
        activityToggle.setAttribute('aria-expanded', String(activityOpen));
        activityToggleIcon.textContent = activityOpen ? '▾' : '▸';
        activitySub.querySelectorAll('.subitem').forEach(a => a.tabIndex = activityOpen ? 0 : -1);
      });
      activityToggle.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.code === 'Space') {
          e.preventDefault();
          activityToggle.click();
        }
      });
    }

    // placeholder demo loader (populates dynamic demoData)
    loadDemo();

    // apply saved locale (or default en)
    const initialLocale = getStoredLocale() === 'ceb' ? 'ceb' : (getStoredLocale() === 'tl' ? 'tl' : 'en');
    translatePage(initialLocale);
  });

  // ---------- existing interaction helpers (sidebar/profile) ----------
  // Sidebar and backdrop logic (copied/kept from your original)
  const hamburger = $('hamburger');
  const sidebar = $('sidebar');
  const sidebarBackdrop = $('sidebarBackdrop');
  const mainContent = $('mainContent');
  let sidebarOpen = false;

  function setSidebar(open, opts = {}) {
    sidebarOpen = !!open;
    sidebar.classList.toggle('open', sidebarOpen);
    sidebar.setAttribute('aria-hidden', String(!sidebarOpen));
    hamburger.setAttribute('aria-expanded', String(sidebarOpen));
    // backdrop should show only on small screens
    if (window.innerWidth <= 900) {
      if (sidebarOpen) {
        sidebarBackdrop.classList.add('show');
        sidebarBackdrop.setAttribute('aria-hidden', 'false');
      } else {
        sidebarBackdrop.classList.remove('show');
        sidebarBackdrop.setAttribute('aria-hidden', 'true');
      }
    } else {
      sidebarBackdrop.classList.remove('show');
      sidebarBackdrop.setAttribute('aria-hidden', 'true');
    }

    if (window.innerWidth > 900) {
      if (sidebarOpen) mainContent.classList.add('shifted');
      else mainContent.classList.remove('shifted');
    } else {
      mainContent.classList.remove('shifted');
    }

    if (opts.shouldFocusToggle) hamburger.focus();
  }

  window.addEventListener('DOMContentLoaded', () => {
    setSidebar(window.innerWidth > 900);
    // make sure subitems unfocusable until opened
    document.querySelectorAll('#activitySub .subitem').forEach(a => a.tabIndex = -1);
  });

  sidebarBackdrop.addEventListener('click', () => setSidebar(false));

  // Close sidebar on mobile after navigation click
  document.querySelectorAll('#sidebar .subitem, #sidebar .nav-item').forEach(el => {
    el.addEventListener('click', (e) => {
      if (window.innerWidth <= 900) setSidebar(false);
    });
  });

  // Profile dropdown wiring variables (also used earlier)
  const profileBtn = $('profileBtn');
  const profileMenu = $('profileMenu');
  let profileOpen = false;

  // Logout
  function doLogout(){
    const keys = [
      'user','currentUser','current_user','username',
      'user_id','userId','userid','authToken','token',
      'planName','matchShapesCompleted','matchShapesInProgress',
      'behaviorChecklistCompleted','locale'
    ];
    keys.forEach(k=>{
      try { localStorage.removeItem(k); } catch(e){}
      try { sessionStorage.removeItem(k); } catch(e){}
    });
    window.location.href = 'signin.html';
  }
  $('logoutBtn')?.addEventListener('click', doLogout);

  // Profile quick links
  $('viewProfileBtn')?.addEventListener('click', ()=>{ window.location.href = 'profile.html'; });
  $('goToAssess')?.addEventListener('click', ()=>{ window.location.href = 'initial_progress_assessment.html'; });

  // Activity submenu keyboard navigation
  const activityToggle = $('activityToggle');
  const activitySub = $('activitySub');
  const activityToggleIcon = $('activityToggleIcon');
  let activityOpen = false;

  activitySub?.addEventListener('keydown', (e) => {
    const items = Array.from(activitySub.querySelectorAll('.subitem'));
    if (!items.length) return;
    const idx = items.indexOf(document.activeElement);
    if (e.key === 'ArrowDown') {
      e.preventDefault();
      const next = items[(idx + 1) % items.length];
      next.focus();
    } else if (e.key === 'ArrowUp') {
      e.preventDefault();
      const prev = items[(idx - 1 + items.length) % items.length];
      prev.focus();
    } else if (e.key === 'Home') {
      e.preventDefault();
      items[0].focus();
    } else if (e.key === 'End') {
      e.preventDefault();
      items[items.length - 1].focus();
    }
  });

  // Placeholder demo loader
  function loadDemo() {
    demoData.n = 3;
    // you can set localized activity strings if you want; currently demoData.recentActivity remains english phrase
    demoData.recentActivity = 'Matched 2 shapes • Submitted checklist';
    // After setting demoData, re-run translate to inject updated placeholders
    translatePage(getStoredLocale());
  }

  // Responsive behavior on resize
  let resizeTimer = null;
  window.addEventListener('resize', () => {
    clearTimeout(resizeTimer);
    resizeTimer = setTimeout(() => {
      if (window.innerWidth > 900) {
        setSidebar(true);
      } else {
        setSidebar(sidebarOpen);
      }
    }, 120);
  });

// ROUTINE nav
  const navRoutine = $('navRoutine');
  if (navRoutine) {
    navRoutine.addEventListener('click', ()=> {
      window.location.href = 'routine.html';
    });
  }



  
  // close UI panels on Escape
  window.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      if (profileOpen) {
        profileOpen = false;
        profileMenu.classList.remove('open');
        profileMenu.setAttribute('aria-hidden', 'true');
        profileBtn.setAttribute('aria-expanded', 'false');
      }
      if (window.innerWidth <= 900 && sidebarOpen) setSidebar(false);
    }
  });
</script>
</body>
</html>
