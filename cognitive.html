<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Cognitive & Learning | NeuroHue</title>
<style>
  :root{
    --teal:#268ea6;
    --dark:#093c44;
    --card-bg:#ffffff;
    --muted:#f3f6f7;
    --accent:#0e7fa8;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: "Arial",sans-serif;
    background:#ffffff;
    color:#08343a;
    min-height:100vh;
  }

  /* Topbar (copied from routine/home) */
  .topbar{
    height:64px;
    background:var(--teal);
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:0 18px;
    color:#fff;
    box-shadow: 0 1px 0 rgba(0,0,0,0.06);
  }
  .brand {
    display:flex;
    align-items:center;
    gap:10px;
    font-weight:700;
  }
  .brand img{ height:34px; width:34px; border-radius:6px; object-fit:cover }
  .brand .title { font-size:18px; }

  .topbar-right {
    display:flex;
    align-items:center;
    gap:12px;
    position:relative;
  }

  .plan-badge{
    background:#fff3cf;
    color:#7a5a10;
    padding:6px 10px;
    border-radius:10px;
    font-size:13px;
    display:flex;
    align-items:center;
    gap:6px;
  }

  .profile {
    background: #0b2b2b;
    color: #fff;
    padding:6px 10px;
    border-radius:22px;
    display:flex;
    align-items:center;
    gap:10px;
    cursor:pointer;
    position:relative;
  }
  .profile .avatar {
    width:34px;height:34px;border-radius:50%;background:#fff;color:var(--dark);display:flex;align-items:center;justify-content:center;font-weight:700;
  }
  .profile .name { font-weight:700; font-size:14px; }

  /* page layout */
  .page {
    display:flex;
    height: calc(100vh - 64px);
  }

  /* sidebar */
  .sidebar {
    width:280px;
    background: #f9fbfc;
    border-right:1px solid #ebeff0;
    padding:18px;
    transform: translateX(-320px);
    transition: transform .22s ease;
    position:relative;
    z-index:30;
  }
  .sidebar.open { transform: translateX(0); box-shadow: 2px 0 14px rgba(0,0,0,0.05); }

  .nav-section { margin-top:6px; }
  .nav-item{
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:10px 12px;
    border-radius:8px;
    cursor:pointer;
    color:#08343a;
    margin-bottom:6px;
  }
  .nav-item:hover{ background: #eef6f7; }

  .hamburger{
    width:34px;height:34px;border-radius:6px;display:flex;align-items:center;justify-content:center;cursor:pointer;background:transparent;border:none;color:#fff;font-size:22px;
  }

  /* content */
  .content {
    flex:1;
    padding:36px;
    overflow:auto;
  }

  .page-title {
    text-align:center;
    color:var(--dark);
    font-weight:800;
    font-size:28px;
    margin-top:6px;
    margin-bottom:28px;
  }

  /* games layout */
  .games-row { display:flex; gap:28px; justify-content:center; flex-wrap:wrap; align-items:flex-start; }
  .game-card {
    width:220px;
    background:#f7fbfc;
    border:1px solid #e6eaeb;
    border-radius:10px;
    padding:18px;
    text-align:center;
    box-shadow: 0 6px 18px rgba(8,52,54,0.03);
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:12px;
  }
  .game-card .meta-small { font-size:13px;color:#666 }
  .game-thumb {
    width:84px; height:84px; border-radius:12px; background:#fff; display:flex; align-items:center; justify-content:center; overflow:hidden; border:1px solid #ecf2f3;
  }
  .game-thumb img { width:72px; height:72px; object-fit:contain; display:block; }
  .game-label { font-size:16px; font-weight:700; color:#0b2b2b; }
  .game-sub { font-size:13px; color:#556971; margin-bottom:6px; }

  .start-btn {
    background:var(--accent); color:white; padding:8px 18px; border-radius:18px; border:none; cursor:pointer; text-decoration:none; display:inline-block; min-width:84px;
  }

  /* profile dropdown */
  .profile-menu{
    position:absolute;
    right:18px;
    top:64px;
    background:#fff;
    border:1px solid #e6eef0;
    border-radius:8px;
    min-width:180px;
    box-shadow:0 6px 20px rgba(8,52,54,0.08);
    display:none;
    z-index:40;
  }
  .profile-menu.open{ display:block; }
  .profile-menu button{
    width:100%;
    border:none;
    background:transparent;
    padding:10px 12px;
    text-align:left;
    cursor:pointer;
  }
  .profile-menu button:hover{ background:#f2f8f9; }

  /* activity sublist */
  .sublist { padding-left:6px; margin-top:6px; display:none; }
  .sublist.open { display:block; }
  .sublist .subitem {
    display:block;
    padding:8px 10px;
    border-radius:6px;
    cursor:pointer;
    font-size:14px;
    color:#2b4d50;
    text-decoration:none;
  }
  .sublist .subitem:hover { background:#eef6f7; }

  @media (max-width:900px){
    .sidebar{ position:absolute; height:100%; left:0; top:64px; }
    .content{ padding:22px; }
    .game-card { width:46%; min-width:180px; }
  }
  @media (max-width:520px){
    .game-card { width:100%; }
    .page-title { font-size:22px; }
  }
</style>
</head>
<body>
  <div class="topbar">
    <div style="display:flex;align-items:center;gap:14px">
      <button id="hamburger" class="hamburger" title="Menu" aria-label="Open menu">☰</button>
      <div class="brand">
        <img src="logo.png" alt="logo" />
        <div class="title">NeuroHue</div>
      </div>
    </div>

    <div class="topbar-right" style="position:relative">
      

      <div id="profileBtn" class="profile" title="Account" aria-haspopup="true" aria-expanded="false">
        <div class="avatar" id="avatar"></div>
        <div class="name" id="topUsername">User</div>
      </div>

      <!-- small profile dropdown -->
      <div id="profileMenu" class="profile-menu" aria-hidden="true">
        <button id="viewProfileBtn">View Profile</button>
        <button id="goToAssess">Initial Assessment</button>
        <button id="logoutBtn">Log Out</button>
      </div>
    </div>
  </div>

  <div class="page">
    <aside id="sidebar" class="sidebar" aria-hidden="true">
      <div style="display:flex;align-items:center;justify-content:space-between">
        <strong style="font-size:14px">Menu</strong>
        <small style="color:#6b8e90">User Actions</small>
      </div>

      <div class="nav-section">
        <div class="nav-item" id="navDashboard" role="button" tabindex="0" title="Go to Dashboard">
          <div>Dashboard</div>
          <div style="font-size:13px;color:#6b8e90">⤴</div>
        </div>

        <div class="nav-item" id="navRoutine" role="button" tabindex="0" title="Go to Routines">
          <div>Routine</div>
          <div style="font-size:13px;color:#6b8e90">⤴</div>
        </div>

        <div class="nav-item" id="activityToggle" role="button" aria-expanded="false" tabindex="0">
          <div>Activity</div>
          <div id="activityToggleIcon" style="font-size:13px;color:#6b8e90">▸</div>
        </div>

        <div id="activitySub" class="sublist" aria-hidden="true" role="menu">
          <a class="subitem" data-activity="gross" href="gross.html" role="menuitem" tabindex="-1">Gross Motor Skills</a>
          <a class="subitem" data-activity="fine" href="fine.html" role="menuitem" tabindex="-1">Fine Motor Skills</a>
          <a class="subitem" data-activity="speech" href="speech.html" role="menuitem" tabindex="-1">Speech &amp; Learning</a>
          <a class="subitem" data-activity="cognitive" href="cognitive.html" role="menuitem" tabindex="-1">Cognitive &amp; Learning</a>
          <a class="subitem" data-activity="behavior" href="behavior.html" role="menuitem" tabindex="-1">Behavior &amp; Social Skills</a>
        </div>
      </div>

      <hr style="margin:14px 0;border:none;border-top:1px solid #eef4f5" />
      <div style="font-size:13px;color:#5f7a7c">Quick Links</div>
      <div style="height:8px"></div>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <button style="padding:8px 12px;border-radius:8px;border:1px solid #e6eef0;background:#fff;color:#2b4d50;cursor:pointer">Progress</button>
        <button style="padding:8px 12px;border-radius:8px;border:1px solid #e6eef0;background:#fff;color:#2b4d50;cursor:pointer">Reports</button>
      </div>
    </aside>

    <main class="content" role="main">
      <div class="page-title">Cognitive &amp; Learning</div>

      <div class="games-row" id="gamesRow">
        <div class="game-card" data-key="shape">
          <div class="meta-small">Game 1</div>
          <div class="game-thumb"><img src="shape.png" alt="Match Shape" /></div>
          <div class="game-label">Match Shape</div>
          <div class="game-sub">Drag and match the shapes to outlines</div>
          <a class="start-btn" id="startShape" href="shape.html">Start</a>
        </div>

        <div class="game-card" data-key="flip">
          <div class="meta-small">Game 2</div>
          <div class="game-thumb"><img src="flip.png" alt="Memory Flip" /></div>
          <div class="game-label">Memory Flip</div>
          <div class="game-sub">Flip and match cards from memory</div>
          <a class="start-btn" id="startFlip" href="flip.html">Start</a>
        </div>

        <div class="game-card" data-key="jigsaw">
          <div class="meta-small">Game 3</div>
          <div class="game-thumb"><img src="jigsaw.png" alt="Jigsaw Puzzle" /></div>
          <div class="game-label">Puzzle Solve</div>
          <div class="game-sub">Put pieces together to solve puzzles</div>
          <a class="start-btn" id="startJigsaw" href="jigsaw.html">Start</a>
        </div>
      </div>
    </main>
  </div>

<script>
  const baseURL = "https://neurohue.onrender.com";

  // small helper
  function $(id){ return document.getElementById(id); }

  // load stored user (robust)
  function loadStoredUser() {
    const raw = localStorage.getItem('user') ?? sessionStorage.getItem('user')
             ?? localStorage.getItem('currentUser') ?? sessionStorage.getItem('currentUser')
             ?? localStorage.getItem('current_user') ?? sessionStorage.getItem('current_user');

    if (!raw) {
      const uname = localStorage.getItem('username') ?? sessionStorage.getItem('username');
      const uid = localStorage.getItem('user_id') ?? sessionStorage.getItem('user_id') ?? localStorage.getItem('userId') ?? sessionStorage.getItem('userId');
      return { id: uid || null, username: uname || null, raw: null };
    }

    try {
      const parsed = JSON.parse(raw);
      const userObj = parsed.user ?? parsed;
      const id = userObj.id ?? userObj.user_id ?? parsed.user_id ?? parsed.id ?? null;
      const username = userObj.username ?? userObj.name ?? parsed.username ?? parsed.email ?? null;
      return { id: id, username: username, raw: parsed };
    } catch (e) {
      return { id: null, username: raw, raw: raw };
    }
  }

  const stored = loadStoredUser();
  const username = stored.username || localStorage.getItem('username') || sessionStorage.getItem('username') || 'User';
  const displayName = username || 'User';
  $('topUsername').textContent = displayName;
  $('avatar').textContent = (displayName && displayName.length>0) ? displayName.charAt(0).toUpperCase() : 'U';

  // Sidebar toggle, default open on wide screens (same behavior as routine)
  const hamburger = $('hamburger');
  const sidebar = $('sidebar');
  let sidebarOpen = false;
  function setSidebarOpen(open){
    sidebarOpen = !!open;
    sidebar.classList.toggle('open', sidebarOpen);
    sidebar.setAttribute('aria-hidden', String(!sidebarOpen));
  }
  hamburger.addEventListener('click', ()=> setSidebarOpen(!sidebarOpen));
  if (window.innerWidth > 900) setSidebarOpen(true);

  // Profile dropdown
  const profileBtn = $('profileBtn');
  const profileMenu = $('profileMenu');
  let profileOpen = false;
  profileBtn.addEventListener('click', (e) => {
    profileOpen = !profileOpen;
    profileMenu.classList.toggle('open', profileOpen);
    profileMenu.setAttribute('aria-hidden', String(!profileOpen));
    profileBtn.setAttribute('aria-expanded', String(profileOpen));
  });
  document.addEventListener('click', (e) => {
    if (!profileBtn.contains(e.target) && !profileMenu.contains(e.target)) {
      profileOpen = false;
      profileMenu.classList.remove('open');
      profileMenu.setAttribute('aria-hidden', 'true');
      profileBtn.setAttribute('aria-expanded', 'false');
    }
  });

  // profile menu actions
  function doLogout(){
    // remove common user keys from both storages
    const keys = [
      'user','currentUser','current_user','username',
      'user_id','userId','userid','authToken','token',
      'planName','matchShapesCompleted','matchShapesInProgress',
      'behaviorChecklistCompleted'
    ];
    keys.forEach(k=>{
      try { localStorage.removeItem(k); } catch(e){}
      try { sessionStorage.removeItem(k); } catch(e){}
    });
    // redirect to signin
    window.location.href = 'signin.html';
  }
  $('logoutBtn')?.addEventListener('click', doLogout);

  $('viewProfileBtn')?.addEventListener('click', ()=> window.location.href='profile.html');
  $('goToAssess')?.addEventListener('click', ()=> window.location.href='initial_progress_assessment.html');

  // Activity toggle
  const activityToggle = $('activityToggle');
  const activitySub = $('activitySub');
  const activityToggleIcon = $('activityToggleIcon');
  let activityOpen = false;
  if (activityToggle) {
    activityToggle.addEventListener('click', () => {
      activityOpen = !activityOpen;
      activitySub.classList.toggle('open', activityOpen);
      activitySub.style.display = activityOpen ? 'block' : 'none';
      activityToggle.setAttribute('aria-expanded', String(activityOpen));
      activityToggleIcon.textContent = activityOpen ? '▾' : '▸';
      activitySub.querySelectorAll('.subitem').forEach(a => a.tabIndex = activityOpen ? 0 : -1);
    });
  }

  // nav items
  $('navDashboard')?.addEventListener('click', ()=> window.location.href='dashboard.html');
  $('navRoutine')?.addEventListener('click', ()=> window.location.href='routine.html');

  // make activity subitems unfocusable until open
  document.querySelectorAll('#activitySub .subitem').forEach(a => a.tabIndex = -1);

  // set plan badge if stored
  const storedPlan = localStorage.getItem('planName') ?? sessionStorage.getItem('planName');
  if (storedPlan) $('planBadge').textContent = storedPlan;

  // store current_user_id before navigation (preserve storage choice)
  function storeCurrentUserId(userId) {
    const sessionKeys = ['user', 'user_id', 'userId', 'userid', 'authToken'];
    for (const k of sessionKeys) {
      if (sessionStorage.getItem(k) !== null) {
        sessionStorage.setItem('current_user_id', String(userId));
        return;
      }
    }
    localStorage.setItem('current_user_id', String(userId));
  }

  // wire start links to set current_user_id
  $('startShape')?.addEventListener('click', (e) => {
    const uid = stored && stored.id ? stored.id : (localStorage.getItem('user_id') || sessionStorage.getItem('user_id'));
    if (uid) storeCurrentUserId(uid);
    // navigation via anchor
  });
  $('startFlip')?.addEventListener('click', (e) => {
    const uid = stored && stored.id ? stored.id : (localStorage.getItem('user_id') || sessionStorage.getItem('user_id'));
    if (uid) storeCurrentUserId(uid);
  });
  $('startJigsaw')?.addEventListener('click', (e) => {
    const uid = stored && stored.id ? stored.id : (localStorage.getItem('user_id') || sessionStorage.getItem('user_id'));
    if (uid) storeCurrentUserId(uid);
  });

  // initialize
  window.addEventListener('DOMContentLoaded', ()=> {
    // default: sidebar open on wide screen (like dashboard)
    if (window.innerWidth > 900) setSidebarOpen(true);
    else setSidebarOpen(false);
  });
</script>
</body>
</html>
